# -*- coding: utf-8 -*-

# This code is part of Qiskit.
#
# (C) Copyright IBM 2020.
#
# This code is licensed under the Apache License, Version 2.0. You may
# obtain a copy of this license in the LICENSE.txt file in the root directory
# of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.
#
# Any modifications or derivative works of this code must retain this
# copyright notice, and modified files need to carry a notice indicating
# that they have been altered from the originals.

""" Test Wine """

from test.ml import QiskitMLTestCase
import numpy as np
from qiskit.ml.datasets import wine
from qiskit.aqua.utils import split_dataset_to_data_and_labels


class TestWine(QiskitMLTestCase):
    """Wine tests."""

    def test_wine(self):
        """Wine test."""

        sample_train_ref = [[-0.57787969, 0.01480729],
                            [-0.08077074, 1.],
                            [0.53226428, -0.34748359],
                            [0.14965679, 0.54757017],
                            [-0.16144462, 0.51863541],
                            [0.08227221, 0.46992656],
                            [-0.34394939, 0.34920538],
                            [0.37252684, -0.7038306],
                            [-0.65663333, -0.20351121],
                            [-0.2600777, -0.49797622],
                            [-0.4077289, 0.31386354],
                            [-0.5139704, 0.47696252],
                            [0.29424493, 0.11520191],
                            [0.15394213, 0.06421584],
                            [-0.79613918, -0.30072726],
                            [0.6844381, -0.46402721],
                            [0.21246006, 0.56087307],
                            [0.56155132, -0.66058141],
                            [0.5434644, -0.6822841],
                            [0.56706284, 0.07904913],
                            [0.13304104, 0.46304318],
                            [-0.39584479, 0.06458521],
                            [0.67745818, -0.19727322],
                            [0.03964442, 0.51250135],
                            [-0.22044836, 0.6578875],
                            [-0.2660061, 0.18490367],
                            [0.61593219, -0.22911037],
                            [0.78455472, -0.64643059],
                            [-0.39965638, -0.16482631],
                            [0.51203864, -0.60291041],
                            [-0.27577155, 0.01308263],
                            [-0.55925442, -0.06504688],
                            [0.64269638, -0.62902403],
                            [0.72867146, -0.13884186],
                            [0.10223925, 0.53989147],
                            [-0.24672325, -0.04495565],
                            [-0.49526341, -0.19805351],
                            [-0.46236529, 0.4821215],
                            [0.13884151, 0.60159999],
                            [-0.19011377, 0.17614574],
                            [-0.21299219, 0.32132487],
                            [-0.30483888, 0.5419942],
                            [-0.70400447, -0.56963638],
                            [-0.43227569, -0.45163289],
                            [0.38342896, 0.34919373],
                            [0.28120877, 0.43609057],
                            [0.39520652, 0.31376016],
                            [-0.62898165, -0.47975367],
                            [0.56757549, -0.12713439],
                            [-0.62895262, -0.33358087],
                            [0.55999237, -0.74174665],
                            [-0.51070535, 0.34941758],
                            [0.61105391, -0.5213297],
                            [-0.59154963, -0.23220511],
                            [0.2380912, -1.],
                            [0.0490538, 0.47431626],
                            [0.00651145, 0.32295393],
                            [0.16807487, 0.48489201],
                            [-0.40359327, -0.19903534],
                            [-0.15470147, 0.87225737],
                            [-0.14914349, -0.07477001],
                            [-0.81071625, -0.44013685],
                            [0.84205302, -0.5461301],
                            [-0.46883581, -0.43398103],
                            [0.67093489, -0.57205815],
                            [0.13418438, 0.46932497],
                            [0.38774002, 0.20296856],
                            [0.67543793, -0.6023643],
                            [0.38594635, 0.44823208],
                            [-0.5780475, -0.24829819],
                            [-0.17281926, 0.35210491],
                            [-0.06796856, 0.22899427],
                            [-0.07480889, 0.52636179],
                            [0.00201465, 0.56838944],
                            [-0.51575035, -0.06222357],
                            [-0.8739398, -0.74625367],
                            [-0.58065968, -0.49940189],
                            [0.0805006, 0.71067283],
                            [0.36235348, 0.32997969],
                            [1., -0.22819634],
                            [-0.20297976, 0.55880474],
                            [-0.4913625, -0.28462408],
                            [0.3375182, 0.5256453],
                            [0.62418922, -0.19766598],
                            [-0.09785944, -0.1265593],
                            [0.43279934, 0.24885048],
                            [-0.45991635, -0.35172275],
                            [0.82624162, -0.28981456],
                            [0.23639244, 0.80670211],
                            [-0.5291351, -0.44650285],
                            [-0.50780664, -0.50715363],
                            [-0.71608903, -0.22203461],
                            [-1., -0.55438588],
                            [0.13104937, 0.56287179],
                            [-0.07288716, 0.55272284],
                            [-0.63792003, -0.22386479],
                            [0.43325982, 0.4019663],
                            [-0.2939105, -0.13214372],
                            [-0.48440353, -0.1861876],
                            [-0.49637657, -0.63280293],
                            [-0.65159286, -0.19073926],
                            [-0.7257561, -0.47593744],
                            [0.73645559, -0.26312691],
                            [0.69344542, -0.12162312],
                            [-0.24091408, -0.09660001],
                            [-0.82368985, -0.66877869],
                            [-0.74224647, -0.05615304],
                            [0.51923366, -0.35604125],
                            [-0.57460712, -0.29940775],
                            [-0.61759187, -0.40178232],
                            [-0.22636185, 0.36096723],
                            [0.53925714, -0.13714159],
                            [-0.57398948, -0.09662826],
                            [0.14716518, 0.58331149],
                            [-0.4970641, -0.33648696],
                            [-0.57119792, -0.34814029],
                            [0.56531951, -0.14267475],
                            [-0.42643827, -0.44257946],
                            [0.32691372, -0.07421793],
                            [0.65489981, -0.47608101],
                            [0.79906439, -0.41382359],
                            [0.11714882, 0.10307985],
                            [0.74599759, -0.80116971],
                            [-0.16748655, 0.61143708],
                            [0.66134589, -0.12200134],
                            [0.44204713, 0.1870817],
                            [-0.43307886, -0.07139711],
                            [-0.80264678, -0.34891449],
                            [0.75963809, 0.0159886],
                            [-0.37128305, 0.22708387],
                            [0.57143715, -0.63088368],
                            [-0.15391532, 0.57947837],
                            [0.5782572, 0.2885163],
                            [-0.50307024, 0.08453178],
                            [0.60301765, -0.03408686],
                            [0.55527394, -0.74735471],
                            [0.15453831, 0.59359868],
                            [0.92930811, -0.24358392],
                            [-0.21773435, -0.26383959],
                            [-0.33465556, 0.1963147],
                            [0.64806033, -0.16126717],
                            [-0.3136008, -0.19948151],
                            [0.32689068, 0.16672148],
                            [0.43219398, -0.46488306],
                            [-0.63106364, -0.398276],
                            [-0.4301612, 0.36259759],
                            [-0.47754405, -0.00818639],
                            [-0.47636013, -0.30081806],
                            [-0.56311028, -0.31709945],
                            [-0.56491667, -0.37682048],
                            [0.222954, 0.62287896],
                            [-0.76101014, -0.39245435],
                            [0.72323076, -0.14221715],
                            [0.39566842, 0.25847603],
                            [0.20984337, 0.04070067],
                            [0.92625832, -0.09605544],
                            [-0.70931788, -0.3209372],
                            [-0.30960387, 0.31765596],
                            [0.15067369, 0.66701599],
                            [0.18087547, 0.2464244],
                            [-0.36848686, 0.12120562],
                            [0.70829343, -0.17447214],
                            [0.47019886, 0.37211094],
                            [0.17542053, 0.67008275],
                            [0.59217081, -0.60612143],
                            [-0.03077173, 0.61576024],
                            [-0.20764019, -0.28404865],
                            [0.62297588, -0.78806392]]

        training_input_ref = {'A': np.asarray([[-0.57787969, 0.01480729],
                                               [-0.65663333, -0.20351121],
                                               [-0.2600777, -0.49797622],
                                               [-0.79613918, -0.30072726],
                                               [-0.39584479, 0.06458521],
                                               [-0.39965638, -0.16482631],
                                               [-0.27577155, 0.01308263],
                                               [-0.24672325, -0.04495565],
                                               [-0.49526341, -0.19805351],
                                               [-0.70400447, -0.56963638],
                                               [-0.43227569, -0.45163289],
                                               [-0.62898165, -0.47975367],
                                               [-0.62895262, -0.33358087],
                                               [-0.59154963, -0.23220511],
                                               [-0.40359327, -0.19903534],
                                               [-0.14914349, -0.07477001],
                                               [-0.81071625, -0.44013685],
                                               [-0.46883581, -0.43398103],
                                               [-0.5780475, -0.24829819],
                                               [-0.51575035, -0.06222357]]),
                              'B': np.asarray([[-0.08077074, 1.],
                                               [0.14965679, 0.54757017],
                                               [-0.16144462, 0.51863541],
                                               [0.08227221, 0.46992656],
                                               [-0.34394939, 0.34920538],
                                               [-0.4077289, 0.31386354],
                                               [-0.5139704, 0.47696252],
                                               [0.29424493, 0.11520191],
                                               [0.15394213, 0.06421584],
                                               [0.21246006, 0.56087307],
                                               [0.13304104, 0.46304318],
                                               [0.03964442, 0.51250135],
                                               [-0.22044836, 0.6578875],
                                               [-0.2660061, 0.18490367],
                                               [-0.55925442, -0.06504688],
                                               [0.10223925, 0.53989147],
                                               [-0.46236529, 0.4821215],
                                               [0.13884151, 0.60159999],
                                               [-0.19011377, 0.17614574],
                                               [-0.21299219, 0.32132487]]),
                              'C': np.asarray([[0.53226428, -0.34748359],
                                               [0.37252684, -0.7038306],
                                               [0.6844381, -0.46402721],
                                               [0.56155132, -0.66058141],
                                               [0.5434644, -0.6822841],
                                               [0.56706284, 0.07904913],
                                               [0.67745818, -0.19727322],
                                               [0.61593219, -0.22911037],
                                               [0.78455472, -0.64643059],
                                               [0.51203864, -0.60291041],
                                               [0.64269638, -0.62902403],
                                               [0.72867146, -0.13884186],
                                               [0.56757549, -0.12713439],
                                               [0.55999237, -0.74174665],
                                               [0.61105391, -0.5213297],
                                               [0.2380912, -1.],
                                               [0.84205302, -0.5461301],
                                               [0.67093489, -0.57205815],
                                               [0.67543793, -0.6023643],
                                               [1., -0.22819634]])}

        test_input_ref = {'A': np.asarray([[-0.30691981, -0.18899987],
                                           [-0.36257736, -0.02620177]]),
                          'B': np.asarray([[0.00550102, 0.28163376],
                                           [0.05539654, 0.26308615],
                                           [-0.15334734, 0.32591395]]),
                          'C': np.asarray([[0.83536685, -0.4025954],
                                           [0.67947172, -0.39078497],
                                           [0.85579425, -0.28314993],
                                           [0.51025744, -0.14249485],
                                           [0.56218094, -0.17315192]])}

        sample_train, training_input, test_input, class_labels = wine(training_size=20,
                                                                      test_size=10,
                                                                      n=2,
                                                                      plot_data=False)

        np.testing.assert_allclose(sample_train, sample_train_ref, rtol=1e-04)
        np.testing.assert_allclose(training_input['A'], training_input_ref['A'], rtol=1e-04)
        np.testing.assert_allclose(training_input['B'], training_input_ref['B'], rtol=1e-04)
        np.testing.assert_allclose(training_input['C'], training_input_ref['C'], rtol=1e-04)
        np.testing.assert_allclose(test_input['A'], test_input_ref['A'])
        np.testing.assert_allclose(test_input['B'], test_input_ref['B'])
        np.testing.assert_allclose(test_input['C'], test_input_ref['C'])
        np.testing.assert_array_equal(class_labels, ['A', 'B', 'C'])

        datapoints, class_to_label = split_dataset_to_data_and_labels(test_input)
        np.testing.assert_array_equal(datapoints[1], [0, 0, 1, 1, 1, 2, 2, 2, 2, 2])
        self.assertDictEqual(class_to_label, {'A': 0, 'B': 1, 'C': 2})
